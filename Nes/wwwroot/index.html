<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8"/>
	<style>
		.error {
			background: yellow;
		}
		#log {
			font-family: monospace;
		}
	</style>
</head>
<body>
<button id="btnTest">Test</button>
<div id="nesContainer"></div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="js/app.js"></script>
<script language="javascript">

	//function runStepTest(url) {
	//	log('<h2>', url, '</h2>');
	//	loadNesEmulator(url, null, function (nesEmulator) {
	//		$.get(url.replace('.nes', '.log')).then(function(logLines) {
	//			new StepTestRuner().run(nesEmulator, logLines, function (st) { log(st) });
	//		});
	//	});
		
	//}

	function runAll(nesRunners) {
		var i = 0;
		function runSingle() {
			if (i < nesRunners.length) {
				nesRunners[i].onEndCallback = function () {
					i++;
					window.setTimeout(runSingle(), 0);
				};
				nesRunners[i].run();
			}			
		}
		runSingle();
	}



	$('#btnTest').click(() => {

		var nesContainerElement = document.getElementById('nesContainer');

		var nesRunners = [
			//new NesRunner(nesContainerElement, 'test/dk.nes'),
			//new NesRunner(nesContainerElement, 'test/smb.nes'),
			//new NesRunner(nesContainerElement, 'test/color_test/color_test.nes'),
			//new NesRunner(nesContainerElement, 'test/palette/palette.nes'),

			//new NesRunner(nesContainerElement, 'test/ppu/vram_access.nes'),
			//new NesRunner(nesContainerElement, 'test/ppu/vbl_clear_time.nes'),
			//new NesRunner(nesContainerElement, 'test/ppu/sprite_ram.nes'),
			//new NesRunner(nesContainerElement, 'test/ppu/palette_ram.nes'),
			//new NesRunner(nesContainerElement, 'test/ppu/power_up_palette.nes'),

			new CpuTestRunner(nesContainerElement, 'test/cpu_interrupts/cpu_interrupts.nes'),
			new CpuTestRunner(nesContainerElement, 'test/cpu_interrupts/rom_singles/1-cli_latency.nes'),
			new CpuTestRunner(nesContainerElement, 'test/cpu_interrupts/rom_singles/2-nmi_and_brk.nes'),
			new CpuTestRunner(nesContainerElement, 'test/cpu_interrupts/rom_singles/3-nmi_and_irq.nes'),
			new CpuTestRunner(nesContainerElement, 'test/cpu_interrupts/rom_singles/4-irq_and_dma.nes'),
			new CpuTestRunner(nesContainerElement, 'test/cpu_interrupts/rom_singles/5-branch_delays_irq.nes'),

			new CpuTestRunner(nesContainerElement, 'test/instr_timing/instr_timing.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_timing/rom_singles/1-instr_timing.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_timing/rom_singles/2-branch_timing.nes'),

			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/01-basics.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/02-implied.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/03-immediate.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/04-zero_page.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/05-zp_xy.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/06-absolute.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/07-abs_xy.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/08-ind_x.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/09-ind_y.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/10-branches.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/11-stack.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/12-jmp_jsr.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/13-rts.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/14-rti.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/15-brk.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/rom_singles/16-special.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/official_only.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_test-v5/all_instrs.nes'),

			new CpuTestRunner(nesContainerElement, 'test/instr_misc/01-abs_x_wrap.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_misc/02-branch_wrap.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_misc/03-dummy_reads.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_misc/04-dummy_reads_apu.nes'),
			new CpuTestRunner(nesContainerElement, 'test/instr_misc/instr_misc.nes')
		];

		runAll(nesRunners);

	});

</script>
</body>
</html>
