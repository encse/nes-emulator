<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8"/>
	<style>
		.passed {
			background: lightgreen;
		}
		.failed{
			background: red;
		}
		.test-case {
			overflow: hidden;
			display: flex;
			margin: 2px;
			height: 80px;
		}
		.test-case canvas {
			order: 1;
			height: 100%;
		}
		.test-case h2 {
			margin: 0;
			padding: 0;
			order: 2;
		}
		.test-case .log {
			order: 3;
		}
		.error {
			background: yellow;
		}
		#log {
			font-family: monospace;
		}
	</style>
</head>
<body>
<button id="btnTest">Test</button>
<div id="nesContainer"></div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="js/app.js"></script>
<script language="javascript">

	//function runStepTest(url) {
	//	log('<h2>', url, '</h2>');
	//	loadNesEmulator(url, null, function (nesEmulator) {
	//		$.get(url.replace('.nes', '.log')).then(function(logLines) {
	//			new StepTestRuner().run(nesEmulator, logLines, function (st) { log(st) });
	//		});
	//	});
		
	//}

	function runAll(nesRunners) {
		var i = 0;
		function runSingle() {
			if (i < nesRunners.length) {
				nesRunners[i].onEndCallback = function () {
					i++;
					window.setTimeout(runSingle(), 0);
				};
				nesRunners[i].run();
			}			
		}
		runSingle();
	}



	$('#btnTest').click(() => {

		var nesContainerElement = document.getElementById('nesContainer');

		var nesRunners = [
			//new NesRunner(nesContainerElement, 'test/dk.nes'),
			//new NesRunner(nesContainerElement, 'test/smb.nes'),
			//new NesRunner(nesContainerElement, 'test/smb/NormalMarioBrosExtreme.nes'),
			//new NesRunner(nesContainerElement, 'test/smb/SuperMarioBros-TimeAndPlace.nes'),
			//new NesRunner(nesContainerElement, 'test/smb/SuperMarioRect.nes'),
			//new NesRunner(nesContainerElement, 'test/smb/supermarioprank.nes'),
			//new NesRunner(nesContainerElement, 'test/smb/SuperMarioGhost.nes'),
			//new NesRunner(nesContainerElement, 'test/smb/SuperKinokoFry.nes'),
			//new NesRunner(nesContainerElement, 'test/smb/ScrollingMarioBros.nes'),
			//new NesRunner(nesContainerElement, 'test/smb/silhouettebros.nes'),
			//new NesRunner(nesContainerElement, 'test/smb/SuperMarioBros-Respawn.nes'),

			//new NesRunner(nesContainerElement, 'test/ppu/color_test/color_test.nes'),
			//new NesRunner(nesContainerElement, 'test/ppu/palette/palette.nes'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/ppu/vram_access.nes', '$01'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/ppu/vbl_clear_time.nes', '$01'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/ppu/sprite_ram.nes', '$01'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/ppu/palette_ram.nes', '$01'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/ppu/power_up_palette.nes', '$01'),

			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_hit_timing/sprite_hit_timing.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_hit_tests_2005.10.05/01.basics.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_hit_tests_2005.10.05/02.alignment.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_hit_tests_2005.10.05/03.corners.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_hit_tests_2005.10.05/04.flip.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_hit_tests_2005.10.05/05.left_clip.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_hit_tests_2005.10.05/06.right_edge.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_hit_tests_2005.10.05/07.screen_bottom.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_hit_tests_2005.10.05/08.double_height.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_hit_tests_2005.10.05/09.timing_basics.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_hit_tests_2005.10.05/10.timing_order.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_hit_tests_2005.10.05/11.edge_timing.nes', 'PASSED'),

			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_overflow_tests/1.Basics.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_overflow_tests/2.Details.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_overflow_tests/3.Timing.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_overflow_tests/4.Obscure.nes', 'PASSED'),
			new CpuTestRunner(nesContainerElement, 'test/ppu/sprite_overflow_tests/5.Emulator.nes', 'PASSED'),

			new CpuTestRunner(nesContainerElement, 'test/cpu/cpu_interrupts/cpu_interrupts.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/cpu_interrupts/rom_singles/1-cli_latency.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/cpu_interrupts/rom_singles/2-nmi_and_brk.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/cpu_interrupts/rom_singles/3-nmi_and_irq.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/cpu_interrupts/rom_singles/4-irq_and_dma.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/cpu_interrupts/rom_singles/5-branch_delays_irq.nes', 'Passed'),

			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_timing/instr_timing.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_timing/rom_singles/1-instr_timing.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_timing/rom_singles/2-branch_timing.nes', 'Passed'),

			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/01-basics.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/02-implied.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/03-immediate.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/04-zero_page.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/05-zp_xy.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/06-absolute.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/07-abs_xy.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/08-ind_x.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/09-ind_y.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/10-branches.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/11-stack.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/12-jmp_jsr.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/13-rts.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/14-rti.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/15-brk.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/rom_singles/16-special.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/official_only.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_test-v5/all_instrs.nes', 'Passed'),

			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_misc/01-abs_x_wrap.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_misc/02-branch_wrap.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_misc/03-dummy_reads.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_misc/04-dummy_reads_apu.nes', 'Passed'),
			new CpuTestRunner(nesContainerElement, 'test/cpu/instr_misc/instr_misc.nes', 'Passed')
		];

		runAll(nesRunners);

	});

</script>
</body>
</html>
